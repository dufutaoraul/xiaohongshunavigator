任务：为 feature/xhs-bridge 分支实现“优秀学员轮播”抓取系统（按下述细则执行）。

前提：
- 仓库： https://github.com/dufutaoraul/xiaohongshunavigator
- 只在 feature/xhs-bridge 分支开发，提交、PR 均到该分支。
- 后端服务在 xhs-service/fastapi-service；前端 Next.js 在根目录。
- Supabase 可用（我会提供 SUPABASE_URL、SUPABASE_ANON_KEY、SUPABASE_SERVICE_ROLE_KEY），注意敏感 key 仅用于后端 env，不要写进代码/日志/PR。

功能与实现步骤（逐项实现并提交小步 commit）：

1) **数据库迁移**：
   - 在 `supabase/migrations/0001_create_xhs_tables.sql` 添加并提交上面给出的 SQL（checkins, notes_cache, xhs_fetch_log, hot_candidates, xhs_alerts）。
   - 提交 migration 文件至分支。

2) **后端：抓取模块**（xhs-service/fastapi-service）
   - 新增模块 `app/workers/fetcher.py`，实现：
     - `pick_students_for_batch(batch_size)`：基于 `students_profiles` 与 `checkins` 计算优先级（as described）。
     - `meta_fetch(link)`：调用 xhs 库或发轻量 HTTP 请求获取 `{note_id, title, cover, url, liked_count, comment_count, published_at}`。
     - `browser_fetch(link)`：只在 meta_fetch 失败且必要时调用，使用 Playwright（可配置开关 `ENABLE_XHS_PROXY`）。
     - 写入 `notes_cache` 与 `xhs_fetch_log`。
     - 并发控制与抖动：最大并发 CONCURRENCY=3，随机 sleep 0.5~2.5s。
     - 错误/退避：对 429/403 做指数退避与暂停策略。
   - 新增调度脚本 `app/scheduler.py` 用 APScheduler，暴露手动触发接口 `POST /admin/recompute`。

3) **后端：Hot candidate 合成 / API**
   - 新增 API `GET /hot-feed?days=7&limit=10`：
     - 从 `notes_cache` 与 `search_logs` 合成两组候选（student_top 和 keyword_top），去重、按点赞降序然后随机抽样（返回 limit 条）。
   - 新增 API `GET /student-top?student_id=xxx&limit=10`：返回 student 个人点赞最高的帖子（从 notes_cache）。

4) **前端：轮播组件**
   - 在 `app/test-simple` 或指定页面顶部/下部加入 `HotCarousel` 组件，调用 `/hot-feed` 显示两组（tab 切换或并列）。
   - 每条卡片显示：封面（cover_image）、标题、作者昵称、点赞数、查看原文（按现有 QR modal 或代理开关）。

5) **打卡写入 / checkin 提交**
   - 在后端新增 `POST /checkin/submit` 保存 checkins，若 `links.length>=1` 设置 `passed=true`。
   - 确保前端提交 checkins 时同时将链接写入 `search_logs`（用于关键词热度统计）。

6) **监控与降级策略**
   - 在 `app/workers/fetcher.py` 中统计连续 429/403 次数，并暴露 `GET /admin/fetch-stats`；若超过阈值，自动减并发并发邮件/日志（或写入 `xhs_fetch_log`）。

7) **测试脚本**
   - 新建 `scripts/test-hot-flow.sh`（curl 脚本）：
     - 插入 3 个示例 student profiles/checkins（mock）
     - 手动触发 `/admin/recompute`
     - 请求 `/hot-feed` 验证返回 JSON 格式与结构
   - 在 PR 里贴脚本输出截图/JSON。

8) **文档与 env 模板**
   - 在仓库根加入 `docs/xhs_fetcher.md` 说明：配置项（BATCH_SIZE, CONCURRENCY, ENABLE_XHS_PROXY）, 如何切换 Playwright, 如何查看 xhs_fetch_log。
   - 添加 `.env` 模板（但不上传真实 keys），并在 README 写清楚如何在 Vercel 设置不同环境（Production/Preview/Development）。

9) **注意：合规与建议**
   - 默认优先使用 meta_fetch（轻量）而不是 Playwright。
   - Playwright 仅在 `ENABLE_XHS_PROXY=true` 时启用，由管理员在有把握的服务器（且能承担资源/风险）上运行。
   - 抓取频率和并发配置必须可调；将这些配置暴露为 environment variables。

10) **PR 要求**
   - 在 PR 描述中包含：实现步骤、迁移 SQL、如何运行本地测试、如何触发手工 recompute、以及如果被风控/封号的应对建议。
   - 标题前缀 `[xhs-bridge]`，并标注 `DO NOT MERGE`。

调度与参数建议（初始值，请写进 config/env）：
- BATCH_SIZE=5
- CONCURRENCY=3
- TTL_HOURS=24
- ENABLE_XHS_PROXY=false
- RETRY_COUNT=3
- RETRY_BACKOFF_BASE_SEC=30

开始前请在本地 checkout feature/xhs-bridge，安装依赖并运行单元与集成测试，开发中任何疑问先尝试自我排查并在 log 中写明尝试过的方案与理由，再提交 PR。
